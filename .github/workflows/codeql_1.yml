name: CodeQL Analysis

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  codeql:
    name: Analyze Code with CodeQL
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    # - name: Setup CodeQL CLI
    #   run: |
    #     mkdir -p $HOME/codeql
    #     curl -L https://github.com/github/codeql-cli-binaries/releases/latest/download/codeql-linux64.zip -o codeql.zip
    #     unzip codeql.zip -d $HOME/codeql
    #     export PATH="$HOME/codeql/codeql:$PATH"

    # - name: Verify CodeQL CLI
    #   run: codeql --version

    - name: Initialize CodeQL
      uses: github/codeql-action/init@v2
      with:
        languages: csharp

    # - name: Autobuild
    #   uses: github/codeql-action/autobuild@v2

    - name: Run CodeQL analysis
      run: |
        codeql database create csharp-db --language=csharp --source-root=$GITHUB_WORKSPACE
        codeql query run --database=csharp-db queries/duplication.ql --format=sarif-latest --output=results.sarif

    - name: Upload SARIF results
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: $GITHUB_WORKSPACE/results.sarif
